Kafka Consumers
==========

Sidekiq worker process that controls the kafka consumers.

Consumers
---------

Currently there are four consumers and one worker, all located [here](/lib/consumers):

- attribution: listens to install events and matches these to clicks,
  to attribute the user to a network. Generates conversion events when a
  match is identified.
- clickstore: responsible for store click events to redis and collection
  statistics on campaign links
- conversion: responsible for handling conversion events and generating
  postback calls for these events.
- postbacks: generates postbacks calls for all events where required.
  This does not handle conversion events.
- url_worker: worker for triggering postback urls generated by the postbacks
  and conversion consumers.

Design
------

Consumers are sidekiq workers and are run by sidekiq. However these are not
directly scheduled with sidekiq, instead for each consumer, there is a
[scheduler](/lib/schedulers) that queues the consumers to be executed.

The intention is to have short running processes consuming events and then
stoping, only to be restarted by the scheduler. This avoids have memory leaks
or zombie consumer processes.

Development
----------

Generate a ```.env``` and then fill it with values:

    prompt> rake appjson:to_dotenv
    prompt> $EDITOR .env

Start the worker and web frontend with:

    prompt> foreman start web
    prompt> foreman start worker

Deployment
----------

[![Deploy To Heroku](https://www.herokucdn.com/deploy/button.png)](https://heroku.com/deploy?template=https://github.com/adtekio/consumers)
